# SRE Code Challenge - Terraform Load-Balancer Module 

This Terraform module creates an Application Load Balancer for the outyet app. The module also attaches the load balancer's target group to an EC2 Autoscaling group (as defined in the inputs) so that EC2 Autoscaling instances can register themselves with the target group automatically. TLS termination is done on the load balancer.

NOTE:
- Requires a pre-created TLS certificate to be created or uploaded to AWS ACM, the ARN of that certificate is an input to the module
- The target group resource is hardcoded to register EC2 autoscaling instances on port 8080
- All HTTP traffic is redirected to the HTTPS listener
- All public, internet HTTP/HTTPS traffic is allowed inbound to the load balancer

## Usage
```hcl
module "srecc-frontend" {
  source                 = "mujahidhemani/srecc-load-balancer/aws"
  vpc_id                 = "${module.srecc-vpc.vpc_id}"
  subnet_ids             = "${module.srecc-vpc.frontend_subnet_ids}"
  autoscaling_group_name = "${module.srecc-ec2-backend.autoscaling_group_name}"
  backend_app_sg_id      = "${module.srecc-ec2-backend.backend_sg_id}"
  tls_cert_arn           = "${var.tls_cert_arn}"
}
```

## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|:----:|:-----:|:-----:|
| autoscaling\_group\_name | The autoscaling group name to attach the load balancer target group to | string | n/a | yes |
| backend\_app\_sg\_id | The security group ID of the app | string | n/a | yes |
| subnet\_ids | A list of frontend subnets to associate to the internet facing side of the load balancer | list | n/a | yes |
| tls\_cert\_arn | The ARN of the TLS certificate to attach to the load balancer listeners | string | n/a | yes |
| vpc\_id | The VPC ID | string | n/a | yes |

## Outputs

| Name | Description |
|------|-------------|
| lb\_dns\_name | The autogenerated public DNS name of the load balancer |
| target\_group\_arn | ARN of the load balancer target group |

